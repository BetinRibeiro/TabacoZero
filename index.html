<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabaco Zero - Programa de Cessação do Tabagismo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: "#2C6E49",
                        secondary: "#4C956C",
                        light: "#FEFEE3",
                        accent: "#D68C45",
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%232C6E49'><path d='M17,11H13V7H11V11H7V13H11V17H13V13H17M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z'/></svg>">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
    <style>
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        .print-section {
            display: none;
        }
        @media print {
            body * {
                visibility: hidden;
            }
            .print-section, .print-section * {
                visibility: visible;
            }
            .print-section {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                display: block !important;
            }
        }
    </style>
</head>
<body class="bg-light font-sans">
    <!-- Interface principal -->
    <div class="min-h-screen flex flex-col">
        <!-- Cabeçalho -->
        <header class="bg-primary text-white py-4 px-6 shadow-lg">
            <div class="flex justify-between items-center">
                <div class="flex items-center">
                    <div class="bg-white rounded-full p-2 mr-3">
                        <i class="fa-solid fa-heart-pulse text-primary text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">Tabaco Zero</h1>
                        <p class="text-xs text-secondary">Programa Municipal de Cessação do Tabagismo</p>
                    </div>
                </div>
                <div class="flex space-x-2">
                    <button id="btnPrint" class="p-2 rounded-full hover:bg-secondary transition">
                        <i class="fa-solid fa-print"></i>
                    </button>
                    <button id="btnShare" class="p-2 rounded-full hover:bg-secondary transition">
                        <i class="fa-solid fa-share-nodes"></i>
                    </button>
                    <button id="btnMenu" class="p-2 rounded-full hover:bg-secondary transition">
                        <i class="fa-solid fa-bars"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Navegação principal -->
        <nav id="mainNav" class="bg-secondary px-4 py-3 shadow-md flex flex-wrap justify-center">
            <button data-target="dashboard" class="nav-btn active px-4 py-2 mx-1 rounded-lg text-white font-medium hover:bg-primary">Visão Geral</button>
            <button data-target="cadastro" class="nav-btn px-4 py-2 mx-1 rounded-lg text-white font-medium hover:bg-primary">Novo Paciente</button>
            <button data-target="triagem" class="nav-btn px-4 py-2 mx-1 rounded-lg text-white font-medium hover:bg-primary">Triagem</button>
            <button data-target="avaliacao" class="nav-btn px-4 py-2 mx-1 rounded-lg text-white font-medium hover:bg-primary">Dependência</button>
            <button data-target="controle" class="nav-btn px-4 py-2 mx-1 rounded-lg text-white font-medium hover:bg-primary">Presenças</button>
            <button data-target="pacientes" class="nav-btn px-4 py-2 mx-1 rounded-lg text-white font-medium hover:bg-primary">Pacientes</button>
        </nav>

        <!-- Seções de conteúdo -->
        <main class="flex-grow p-4 md:p-6 overflow-auto scrollbar-hide">
            <!-- Dashboard -->
            <section id="dashboard" class="section active fade-in">
                <h2 class="text-xl font-bold text-primary mb-4">Visão Geral do Programa</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white rounded-xl shadow-md p-5">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-gray-500">Pacientes Cadastrados</p>
                                <p id="totalPatients" class="text-3xl font-bold text-primary mt-2">0</p>
                            </div>
                            <div class="bg-light p-3 rounded-lg">
                                <i class="fa-solid fa-user-group text-primary text-xl"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-md p-5">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-gray-500">Avaliações Realizadas</p>
                                <p id="totalAssessments" class="text-3xl font-bold text-accent mt-2">0</p>
                            </div>
                            <div class="bg-light p-3 rounded-lg">
                                <i class="fa-solid fa-clipboard-check text-accent text-xl"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-md p-5">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-gray-500">Consultas Programadas</p>
                                <p id="totalConsultations" class="text-3xl font-bold text-secondary mt-2">0</p>
                            </div>
                            <div class="bg-light p-3 rounded-lg">
                                <i class="fa-solid fa-calendar-check text-secondary text-xl"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-md p-5">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-gray-500">Sessões Hoje</p>
                                <p id="totalSessionsToday" class="text-3xl font-bold text-primary mt-2">0</p>
                            </div>
                            <div class="bg-light p-3 rounded-lg">
                                <i class="fa-solid fa-people-arrows text-primary text-xl"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white rounded-xl shadow-md p-5">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-bold text-gray-700">Pacientes Recentes</h3>
                            <button id="btnRefreshPatients" class="p-1 rounded hover:bg-light text-primary">
                                <i class="fa-solid fa-rotate"></i>
                            </button>
                        </div>
                        <div id="recentPatients" class="max-h-80 overflow-y-auto">
                            <!-- Lista de pacientes será inserida aqui -->
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-5">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-bold text-gray-700">Agenda de Sessões</h3>
                            <button class="text-xs bg-primary text-white px-3 py-1 rounded-md hover:bg-secondary">Ver Agenda</button>
                        </div>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between p-3 rounded-lg bg-light">
                                <div class="flex items-center">
                                    <div class="bg-white p-2 rounded-lg mr-3">
                                        <i class="fa-solid fa-clock text-secondary"></i>
                                    </div>
                                    <div>
                                        <p class="font-medium">Grupo de apoio</p>
                                        <p class="text-sm text-gray-600">Hoje, 14:00 - Centro de Saúde Central</p>
                                    </div>
                                </div>
                                <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded">5 participantes</span>
                            </div>
                            <div class="flex items-center justify-between p-3 rounded-lg bg-light">
                                <div class="flex items-center">
                                    <div class="bg-white p-2 rounded-lg mr-3">
                                        <i class="fa-solid fa-clock text-secondary"></i>
                                    </div>
                                    <div>
                                        <p class="font-medium">Consultas médicas</p>
                                        <p class="text-sm text-gray-600">Amanhã, 10:00 - Unidade Básica Jardins</p>
                                    </div>
                                </div>
                                <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded">3 participantes</span>
                            </div>
                            <div class="flex items-center justify-between p-3 rounded-lg bg-light">
                                <div class="flex items-center">
                                    <div class="bg-white p-2 rounded-lg mr-3">
                                        <i class="fa-solid fa-clock text-secondary"></i>
                                    </div>
                                    <div>
                                        <p class="font-medium">Sessão motivacional</p>
                                        <p class="text-sm text-gray-600">Quinta, 16:00 - Centro Comunitário</p>
                                    </div>
                                </div>
                                <span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded">2 vagas</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Cadastro de Pacientes -->
            <section id="cadastro" class="section hidden">
                <div class="bg-white rounded-xl shadow-md overflow-hidden max-w-4xl mx-auto">
                    <div class="bg-primary py-3 px-6">
                        <h2 class="text-white text-xl font-bold">Cadastro de Paciente</h2>
                    </div>
                    <form id="patientForm" class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-gray-700 mb-2">Nome Completo *</label>
                                <input type="text" name="nome" required class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-2">Data de Nascimento *</label>
                                <input type="date" name="nascimento" required class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-2">CPF *</label>
                                <input type="text" name="cpf" required class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="000.000.000-00" data-mask="000.000.000-00" data-mask-reverse="true">
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-2">Cartão SUS *</label>
                                <input type="text" name="sus" required class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="000 0000 0000 0000" data-mask="000 0000 0000 0000">
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-2">Nome da Mãe *</label>
                                <input type="text" name="mae" required class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-2">Telefone *</label>
                                <input type="tel" name="telefone" required class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="(00) 00000-0000" data-mask="(00) 00000-0000">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-gray-700 mb-2">Endereço Completo *</label>
                                <input type="text" name="endereco" required class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-2">Número do Prontuário</label>
                                <input type="text" name="prontuario" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-2">CID</label>
                                <input type="text" name="cid" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="Ex: F17.0">
                            </div>
                        </div>
                        <div class="mt-8 flex justify-end space-x-3">
                            <button type="reset" class="px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition">Limpar</button>
                            <button type="submit" class="px-6 py-2 bg-primary text-white rounded-lg hover:bg-secondary transition">Salvar Cadastro</button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- Triagem Clínica -->
            <section id="triagem" class="section hidden">
                <div class="max-w-4xl mx-auto">
                    <div class="bg-white rounded-xl shadow-md overflow-hidden">
                        <div class="bg-accent py-3 px-6">
                            <h2 class="text-white text-xl font-bold">Triagem Clínica</h2>
                        </div>
                        <div class="p-6">
                            <div class="mb-6">
                                <label class="block text-gray-700 mb-2">Selecionar Paciente</label>
                                <select id="patientSelect" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                                    <option value="">-- Selecione um paciente --</option>
                                </select>
                            </div>
                            
                            <form id="screeningForm">
                                <h3 class="font-bold text-primary mb-4">Histórico de Saúde</h3>
                                <div class="space-y-5">
                                    <div class="p-4 border rounded-lg">
                                        <p class="font-medium mb-3">Doenças respiratórias diagnosticadas?</p>
                                        <div class="flex space-x-4">
                                            <label class="inline-flex items-center">
                                                <input type="radio" name="respiratorias" value="sim" class="form-radio text-primary"> 
                                                <span class="ml-2">Sim</span>
                                            </label>
                                            <label class="inline-flex items-center">
                                                <input type="radio" name="respiratorias" value="nao" class="form-radio text-primary" checked> 
                                                <span class="ml-2">Não</span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="p-4 border rounded-lg">
                                        <p class="font-medium mb-3">Problemas cardíacos?</p>
                                        <div class="flex space-x-4">
                                            <label class="inline-flex items-center">
                                                <input type="radio" name="cardiacos" value="sim" class="form-radio text-primary"> 
                                                <span class="ml-2">Sim</span>
                                            </label>
                                            <label class="inline-flex items-center">
                                                <input type="radio" name="cardiacos" value="nao" class="form-radio text-primary" checked> 
                                                <span class="ml-2">Não</span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="p-4 border rounded-lg">
                                        <p class="font-medium mb-3">Uso de medicamentos controlados?</p>
                                        <div class="flex space-x-4">
                                            <label class="inline-flex items-center">
                                                <input type="radio" name="medicamentos" value="sim" class="form-radio text-primary"> 
                                                <span class="ml-2">Sim</span>
                                            </label>
                                            <label class="inline-flex items-center">
                                                <input type="radio" name="medicamentos" value="nao" class="form-radio text-primary" checked> 
                                                <span class="ml-2">Não</span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="p-4 border rounded-lg">
                                        <p class="font-medium mb-3">Consumo regular de álcool?</p>
                                        <div class="flex space-x-4">
                                            <label class="inline-flex items-center">
                                                <input type="radio" name="alcool" value="sim" class="form-radio text-primary"> 
                                                <span class="ml-2">Sim</span>
                                            </label>
                                            <label class="inline-flex items-center">
                                                <input type="radio" name="alcool" value="nao" class="form-radio text-primary" checked> 
                                                <span class="ml-2">Não</span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="p-4 border rounded-lg">
                                        <p class="font-medium mb-3">Gravidez atual?</p>
                                        <div class="flex space-x-4">
                                            <label class="inline-flex items-center">
                                                <input type="radio" name="gravidez" value="sim" class="form-radio text-primary"> 
                                                <span class="ml-2">Sim</span>
                                            </label>
                                            <label class="inline-flex items-center">
                                                <input type="radio" name="gravidez" value="nao" class="form-radio text-primary" checked> 
                                                <span class="ml-2">Não</span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="p-4 border rounded-lg">
                                        <p class="font-medium mb-3">Amamentando?</p>
                                        <div class="flex space-x-4">
                                            <label class="inline-flex items-center">
                                                <input type="radio" name="amamentando" value="sim" class="form-radio text-primary"> 
                                                <span class="ml-2">Sim</span>
                                            </label>
                                            <label class="inline-flex items-center">
                                                <input type="radio" name="amamentando" value="nao" class="form-radio text-primary" checked> 
                                                <span class="ml-2">Não</span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="p-4 border rounded-lg">
                                        <p class="font-medium mb-3">Diagnóstico de transtornos psicológicos?</p>
                                        <div class="flex space-x-4">
                                            <label class="inline-flex items-center">
                                                <input type="radio" name="transtornos" value="sim" class="form-radio text-primary"> 
                                                <span class="ml-2">Sim</span>
                                            </label>
                                            <label class="inline-flex items-center">
                                                <input type="radio" name="transtornos" value="nao" class="form-radio text-primary" checked> 
                                                <span class="ml-2">Não</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-8 flex justify-end space-x-3">
                                    <button type="reset" class="px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition">Limpar</button>
                                    <button type="submit" class="px-6 py-2 bg-primary text-white rounded-lg hover:bg-secondary transition">Salvar Triagem</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Avaliação de Dependência -->
            <section id="avaliacao" class="section hidden">
                <div class="max-w-4xl mx-auto">
                    <div class="bg-white rounded-xl shadow-md overflow-hidden">
                        <div class="bg-secondary py-3 px-6">
                            <h2 class="text-white text-xl font-bold">Avaliação de Dependência à Nicotina</h2>
                        </div>
                        <div class="p-6">
                            <div class="mb-6">
                                <label class="block text-gray-700 mb-2">Selecionar Paciente</label>
                                <select id="patientSelectAssessment" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                                    <option value="">-- Selecione um paciente --</option>
                                </select>
                            </div>
                            
                            <form id="assessmentForm">
                                <div class="space-y-6">
                                    <div class="p-5 border rounded-lg bg-light">
                                        <p class="font-medium mb-3">1. Quanto tempo depois de acordar você fuma seu primeiro cigarro?</p>
                                        <div class="space-y-3">
                                            <label class="flex items-center space-x-3">
                                                <input type="radio" name="tempo" value="5" class="form-radio text-primary"> 
                                                <span>Dentro de 5 minutos</span>
                                            </label>
                                            <label class="flex items-center space-x-3">
                                                <input type="radio" name="tempo" value="15" class="form-radio text-primary"> 
                                                <span>De 6 a 30 minutos</span>
                                            </label>
                                            <label class="flex items-center space-x-3">
                                                <input type="radio" name="tempo" value="30" class="form-radio text-primary"> 
                                                <span>De 31 a 60 minutos</span>
                                            </label>
                                            <label class="flex items-center space-x-3">
                                                <input type="radio" name="tempo" value="60" class="form-radio text-primary"> 
                                                <span>Após 60 minutos</span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="p-5 border rounded-lg bg-light">
                                        <p class="font-medium mb-3">2. Quantos cigarros você fuma por dia?</p>
                                        <div class="space-y-3">
                                            <label class="flex items-center space-x-3">
                                                <input type="radio" name="cigarros" value="3" class="form-radio text-primary"> 
                                                <span>31 ou mais</span>
                                            </label>
                                            <label class="flex items-center space-x-3">
                                                <input type="radio" name="cigarros" value="2" class="form-radio text-primary"> 
                                                <span>21 a 30</span>
                                            </label>
                                            <label class="flex items-center space-x-3">
                                                <input type="radio" name="cigarros" value="1" class="form-radio text-primary"> 
                                                <span>11 a 20</span>
                                            </label>
                                            <label class="flex items-center space-x-3">
                                                <input type="radio" name="cigarros" value="0" class="form-radio text-primary"> 
                                                <span>10 ou menos</span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="p-5 border rounded-lg bg-light">
                                        <p class="font-medium mb-3">3. Você acha difícil não fumar em lugares proibidos?</p>
                                        <div class="space-y-3">
                                            <label class="flex items-center space-x-3">
                                                <input type="radio" name="dificuldade" value="1" class="form-radio text-primary"> 
                                                <span>Sim</span>
                                            </label>
                                            <label class="flex items-center space-x-3">
                                                <input type="radio" name="dificuldade" value="0" class="form-radio text-primary"> 
                                                <span>Não</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="resultPanel" class="mt-8 hidden p-5 bg-blue-50 rounded-xl">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <p class="font-medium">Resultado da Avaliação:</p>
                                            <h3 id="dependenceLevel" class="text-xl font-bold">Baixa Dependência</h3>
                                            <p id="dependenceDescription" class="mt-1">Você apresenta sinais de baixa dependência à nicotina.</p>
                                        </div>
                                        <div id="levelBadge" class="text-4xl">
                                            <i class="fa-solid fa-circle-check text-green-500"></i>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-8 flex justify-end space-x-3">
                                    <button type="reset" class="px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition">Limpar</button>
                                    <button type="button" id="btnCalculate" class="px-6 py-2 bg-primary text-white rounded-lg hover:bg-secondary transition">Calcular Dependência</button>
                                    <button type="submit" class="px-6 py-2 bg-secondary text-white rounded-lg hover:bg-primary transition hidden">Salvar Avaliação</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Controle de Presenças -->
            <section id="controle" class="section hidden">
                <div class="max-w-4xl mx-auto">
                    <div class="bg-white rounded-xl shadow-md overflow-hidden">
                        <div class="bg-primary py-3 px-6">
                            <h2 class="text-white text-xl font-bold">Controle de Presenças</h2>
                        </div>
                        <div class="p-6">
                            <div class="mb-6">
                                <label class="block text-gray-700 mb-2">Selecionar Paciente</label>
                                <select id="patientSelectAttendance" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                                    <option value="">-- Selecione um paciente --</option>
                                </select>
                            </div>
                            
                            <div id="patientAttendanceInfo" class="hidden p-5 bg-light rounded-xl mb-6">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <h3 id="patientAttendanceName" class="font-bold text-lg"></h3>
                                        <p>Presenças registradas: <span id="attendanceCount" class="font-bold">0</span> de <span class="font-bold">3</span></p>
                                        <p id="aptoStatus" class="mt-2 text-sm italic">Ainda não está apto para consulta médica</p>
                                    </div>
                                    <div id="aptoBadge" class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm hidden">
                                        <i class="fa-solid fa-xmark mr-1"></i> Não Apto
                                    </div>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="p-5 border rounded-lg">
                                    <h3 class="font-medium mb-4">Registrar Presença</h3>
                                    <form id="attendanceForm" class="space-y-4">
                                        <div>
                                            <label class="block text-gray-700 mb-2">Data</label>
                                            <input type="date" id="attendanceDate" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 mb-2">Tipo de Sessão</label>
                                            <select id="sessionType" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                                                <option value="grupo">Grupo de Apoio</option>
                                                <option value="individual">Acompanhamento Individual</option>
                                                <option value="medica">Consulta Médica</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 mb-2">Local</label>
                                            <select id="sessionLocation" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                                                <option value="central">Centro de Saúde Central</option>
                                                <option value="jardins">UBS Jardins</option>
                                                <option value="comunitario">Centro Comunitário</option>
                                            </select>
                                        </div>
                                        <button type="submit" class="w-full py-3 bg-primary text-white rounded-lg hover:bg-secondary transition">
                                            <i class="fa-solid fa-check mr-2"></i> Registrar Presença
                                        </button>
                                    </form>
                                </div>
                                
                                <div class="p-5 border rounded-lg">
                                    <h3 class="font-medium mb-4">Registros de Presença</h3>
                                    <div id="attendanceList" class="max-h-80 overflow-y-auto">
                                        <!-- Lista de presenças será inserida aqui -->
                                        <div class="text-center py-10 text-gray-400">
                                            <i class="fa-regular fa-calendar text-3xl mb-3"></i>
                                            <p>Nenhuma presença registrada</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Lista de Pacientes -->
            <section id="pacientes" class="section hidden">
                <div class="max-w-6xl mx-auto">
                    <div class="bg-white rounded-xl shadow-md overflow-hidden">
                        <div class="bg-primary py-3 px-6">
                            <h2 class="text-white text-xl font-bold">Pacientes Cadastrados</h2>
                        </div>
                        <div class="p-6">
                            <div class="flex flex-col sm:flex-row justify-between gap-4 mb-6">
                                <div class="relative w-full sm:w-80">
                                    <input type="text" id="searchPatients" placeholder="Buscar por nome, CPF ou SUS..." class="w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                                    <i class="fa-solid fa-search absolute left-3 top-3 text-gray-400"></i>
                                </div>
                                <div class="flex space-x-2">
                                    <button id="btnExport" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition">
                                        <i class="fa-solid fa-file-export mr-2"></i> Exportar
                                    </button>
                                    <button id="btnDeleteAll" class="px-4 py-2 bg-red-50 text-red-700 rounded-lg hover:bg-red-100 transition">
                                        <i class="fa-solid fa-trash mr-2"></i> Limpar Dados
                                    </button>
                                </div>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-light">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Paciente</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Idade</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Triagem</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Dependência</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Presenças</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Apto</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="patientsTable" class="divide-y divide-gray-200">
                                        <!-- Conteúdo da tabela será inserido aqui -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div id="noPatients" class="text-center py-10 text-gray-400">
                                <i class="fa-regular fa-user text-3xl mb-3"></i>
                                <p>Nenhum paciente cadastrado</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Área de impressão escondida -->
    <div class="print-section p-6">
        <div class="text-center mb-6">
            <h1 class="text-2xl font-bold">Sistema de Controle Tabagismo</h1>
            <p>Relatório de pacientes cadastrados - <span id="printDate"></span></p>
        </div>
        
        <table class="w-full border-collapse border border-gray-300">
            <thead>
                <tr class="bg-gray-100">
                    <th class="border border-gray-300 px-4 py-2">Paciente</th>
                    <th class="border border-gray-300 px-4 py-2">CPF</th>
                    <th class="border border-gray-300 px-4 py-2">Cartão SUS</th>
                    <th class="border border-gray-300 px-4 py-2">Triagem</th>
                    <th class="border border-gray-300 px-4 py-2">Dependência</th>
                    <th class="border border-gray-300 px-4 py-2">Presenças</th>
                </tr>
            </thead>
            <tbody id="printTable">
                <!-- Conteúdo será inserido aqui -->
            </tbody>
        </table>
        
        <div class="mt-8">
            <div class="flex justify-between">
                <div class="text-sm">
                    Gerado por: Sistema Tabaco Zero
                </div>
                <div class="text-sm">
                    Página 1 de 1
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuração do IndexedDB
        const DB_NAME = "tabagismo_db";
        const DB_VERSION = 1;
        const STORE_NAME = "pacientes";

        let db;
        const request = indexedDB.open(DB_NAME, DB_VERSION);

        request.onupgradeneeded = (event) => {
            db = event.target.result;
            
            // Criar objectStore se não existir
            if (!db.objectStoreNames.contains(STORE_NAME)) {
                const store = db.createObjectStore(STORE_NAME, { keyPath: "id", autoIncrement: true });
                store.createIndex("nome", "nome", { unique: false });
                store.createIndex("cpf", "cpf", { unique: true });
            }
        };

        request.onsuccess = (event) => {
            db = event.target.result;
            loadPatients();
        };

        request.onerror = (event) => {
            console.error("Erro ao abrir o banco de dados", event.target.error);
        };

        // Funções do banco de dados
        function addPatient(patient) {
            const transaction = db.transaction([STORE_NAME], "readwrite");
            const store = transaction.objectStore(STORE_NAME);
            const request = store.add(patient);
            
            request.onsuccess = () => {
                console.log("Paciente adicionado");
                loadPatients();
            };
            
            request.onerror = () => {
                console.error("Erro ao adicionar paciente");
            };
        }

        function getAllPatients(callback) {
            const transaction = db.transaction([STORE_NAME], "readonly");
            const store = transaction.objectStore(STORE_NAME);
            const request = store.getAll();
            
            request.onsuccess = () => {
                callback(request.result);
            };
        }

        function updatePatient(id, updateData) {
            const transaction = db.transaction([STORE_NAME], "readwrite");
            const store = transaction.objectStore(STORE_NAME);
            const getRequest = store.get(id);
            
            getRequest.onsuccess = () => {
                const patient = getRequest.result;
                const updatedPatient = { ...patient, ...updateData };
                
                const updateRequest = store.put(updatedPatient);
                updateRequest.onsuccess = () => {
                    console.log("Paciente atualizado");
                    loadPatients();
                    document.getElementById('patientAttendanceInfo').classList.remove('hidden');
                };
            };
        }

        function deleteAllPatients() {
            if(confirm("Tem certeza que deseja excluir TODOS os dados? Esta ação não pode ser desfeita.")) {
                const transaction = db.transaction([STORE_NAME], "readwrite");
                const store = transaction.objectStore(STORE_NAME);
                const request = store.clear();
                
                request.onsuccess = () => {
                    console.log("Todos os dados foram excluídos");
                    loadPatients();
                    
                    // Limpar selects
                    ['patientSelect', 'patientSelectAssessment', 'patientSelectAttendance'].forEach(id => {
                        const select = document.getElementById(id);
                        while(select.options.length > 1) {
                            select.remove(1);
                        }
                    });
                    
                    // Esconder informações de paciente
                    document.getElementById('patientAttendanceInfo').classList.add('hidden');
                    
                    // Atualizar UI
                    document.getElementById('totalPatients').textContent = '0';
                    document.getElementById('recentPatients').innerHTML = `
                        <div class="text-center py-10 text-gray-400">
                            <i class="fa-regular fa-user text-3xl mb-3"></i>
                            <p>Nenhum paciente cadastrado</p>
                        </div>
                    `;
                };
            }
        }

        // Funções de interface do usuário
        function loadPatients() {
            getAllPatients(patients => {
                // Atualizar contador
                document.getElementById('totalPatients').textContent = patients.length;
                
                // Atualizar contadores simulados
                document.getElementById('totalAssessments').textContent = patients.filter(p => p.dependencia).length;
                document.getElementById('totalConsultations').textContent = patients.filter(p => p.apto).length;
                document.getElementById('totalSessionsToday').textContent = Math.min(patients.length, 3);
                
                // Atualizar selects de paciente
                const selects = [
                    'patientSelect', 
                    'patientSelectAssessment', 
                    'patientSelectAttendance',
                    'patientsTable',
                    'recentPatients'
                ];
                
                selects.forEach(id => {
                    const element = document.getElementById(id);
                    
                    // Limpar selects, exceto a primeira opção
                    if(id.includes('Select')) {
                        while(element.options.length > 1) {
                            element.remove(1);
                        }
                    }
                    
                    // Preencher seletor de pacientes
                    if(id.includes('Select')) {
                        patients.forEach(patient => {
                            const option = document.createElement('option');
                            option.value = patient.id;
                            option.textContent = patient.nome;
                            element.appendChild(option);
                        });
                    }
                    
                    // Preencher tabela de pacientes
                    if(id === 'patientsTable' || id === 'recentPatients') {
                        // Limpar lista
                        element.innerHTML = '';
                        
                        if(patients.length === 0) {
                            document.getElementById('noPatients').classList.remove('hidden');
                            if(id === 'recentPatients') {
                                element.innerHTML = `
                                    <div class="text-center py-10 text-gray-400">
                                        <i class="fa-regular fa-user text-3xl mb-3"></i>
                                        <p>Nenhum paciente cadastrado</p>
                                    </div>
                                `;
                            }
                            return;
                        }
                        
                        document.getElementById('noPatients').classList.add('hidden');
                        
                        // Ordenar pacientes por id decrescente (mais recentes primeiro)
                        const sortedPatients = [...patients].sort((a, b) => b.id - a.id);
                        
                        // Para a lista recente (dashboard), mostrar até 5
                        const displayedPatients = id === 'recentPatients' ? sortedPatients.slice(0, 5) : sortedPatients;
                        
                        displayedPatients.forEach(patient => {
                            if(id === 'patientsTable') {
                                // Linha da tabela completa
                                const tr = document.createElement('tr');
                                tr.innerHTML = `
                                    <td class="px-4 py-3">
                                        <div>
                                            <p class="font-medium">${patient.nome}</p>
                                            <p class="text-xs text-gray-500">${patient.cpf}</p>
                                        </div>
                                    </td>
                                    <td class="px-4 py-3 text-sm">${calculateAge(patient.nascimento)} anos</td>
                                    <td class="px-4 py-3">
                                        ${patient.triagem 
                                            ? '<span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">Completa</span>'
                                            : '<span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs">Pendente</span>'}
                                    </td>
                                    <td class="px-4 py-3">
                                        ${patient.dependencia 
                                            ? `<span class="${getDependencyClass(patient.dependencia.level)}">${patient.dependencia.level}</span>` 
                                            : '<span class="text-gray-500">-</span>'}
                                    </td>
                                    <td class="px-4 py-3">
                                        <div class="flex items-center">
                                            <span class="mr-2">${patient.presencas ? patient.presencas.length : 0}</span>
                                            ${getAttendanceIcons(patient.presencas)}
                                        </div>
                                    </td>
                                    <td class="px-4 py-3">
                                        ${patient.apto 
                                            ? '<span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">Apto</span>' 
                                            : '<span class="bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs">Não apto</span>'}
                                    </td>
                                    <td class="px-4 py-3">
                                        <div class="flex space-x-1">
                                            <button class="action-btn view-btn" data-id="${patient.id}">
                                                <i class="fa-solid fa-eye text-blue-500"></i>
                                            </button>
                                            <button class="action-btn edit-btn" data-id="${patient.id}">
                                                <i class="fa-solid fa-pen text-green-500"></i>
                                            </button>
                                            <button class="action-btn delete-btn" data-id="${patient.id}">
                                                <i class="fa-solid fa-trash text-red-500"></i>
                                            </button>
                                        </div>
                                    </td>
                                `;
                                element.appendChild(tr);
                            } else {
                                // Item da lista de pacientes recentes (dashboard)
                                const div = document.createElement('div');
                                div.className = 'flex items-center py-3 border-b';
                                div.innerHTML = `
                                    <div class="bg-gray-200 border-2 border-dashed rounded-xl w-16 h-16 mr-3"></div>
                                    <div class="flex-grow">
                                        <p class="font-medium">${patient.nome}</p>
                                        <div class="flex justify-between text-sm text-gray-500">
                                            <span>${calculateAge(patient.nascimento)} anos</span>
                                            <span>${patient.presencas ? patient.presencas.length : 0}/3 sessões</span>
                                        </div>
                                    </div>
                                `;
                                element.appendChild(div);
                            }
                        });
                    }
                });
            });
        }

        function calculateAge(birthDate) {
            if(!birthDate) return 'N/A';
            const birth = new Date(birthDate);
            const today = new Date();
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            
            return age;
        }

        function getDependencyClass(level) {
            const classes = {
                'Baixa': 'bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs',
                'Moderada': 'bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs',
                'Alta': 'bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs'
            };
            return classes[level] || '';
        }

        function getAttendanceIcons(attendances) {
            if(!attendances || attendances.length === 0) {
                return '<span class="text-gray-300"><i class="fa-solid fa-circle"></i><i class="fa-solid fa-circle"></i><i class="fa-solid fa-circle"></i></span>';
            }
            
            let icons = '';
            for (let i = 0; i < 3; i++) {
                icons += i < attendances.length 
                    ? '<i class="fa-solid fa-circle-check text-green-500"></i>' 
                    : '<i class="fa-solid fa-circle text-gray-300"></i>';
            }
            return icons;
        }

        // Navegação
        const navButtons = document.querySelectorAll('.nav-btn');
        const sections = document.querySelectorAll('.section');
        
        navButtons.forEach(button => {
            button.addEventListener('click', () => {
                const target = button.getAttribute('data-target');
                
                // Remover classe ativa de todos os botões
                navButtons.forEach(btn => btn.classList.remove('active'));
                // Adicionar classe ativa ao botão clicado
                button.classList.add('active');
                
                // Esconder todas as seções
                sections.forEach(section => {
                    section.classList.remove('active');
                    section.classList.add('hidden');
                });
                
                // Mostrar a seção alvo
                const targetSection = document.getElementById(target);
                targetSection.classList.remove('hidden');
                setTimeout(() => {
                    targetSection.classList.add('active');
                }, 10);
                
                // Atualizar lists para seções específicas
                if(target === 'pacientes' || target === 'dashboard') {
                    loadPatients();
                }
                
                // Preencher selects para outras seções
                if(target === 'triagem' || target === 'avaliacao' || target === 'controle') {
                    updateSelects();
                }
            });
        });

        // Menu mobile (simplificado)
        document.getElementById('btnMenu').addEventListener('click', () => {
            document.getElementById('mainNav').classList.toggle('hidden');
            document.getElementById('mainNav').classList.toggle('flex');
        });

        // Função para atualizar os selects de paciente
        function updateSelects() {
            getAllPatients(patients => {
                const selects = [
                    'patientSelect', 
                    'patientSelectAssessment', 
                    'patientSelectAttendance'
                ];
                
                selects.forEach(id => {
                    const select = document.getElementById(id);
                    // Limpar selects, exceto a primeira opção
                    while(select.options.length > 1) {
                        select.remove(1);
                    }
                    
                    // Preencher com pacientes
                    patients.forEach(patient => {
                        const option = document.createElement('option');
                        option.value = patient.id;
                        option.textContent = patient.nome;
                        select.appendChild(option);
                    });
                });
            });
        }

        // Eventos para formulários
        document.getElementById('patientForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const patient = {
                nome: formData.get('nome'),
                cpf: formData.get('cpf'),
                sus: formData.get('sus'),
                nascimento: formData.get('nascimento'),
                endereco: formData.get('endereco'),
                telefone: formData.get('telefone'),
                mae: formData.get('mae'),
                prontuario: formData.get('prontuario'),
                cid: formData.get('cid'),
                // Campos de acompanhamento iniciais
                triagem: false,
                dependencia: null,
                presencas: [],
                apto: false
            };
            
            addPatient(patient);
            this.reset();
            
            // Feedback ao usuário
            alert('Paciente cadastrado com sucesso!');
            // Ir para a seção de triagem
            document.querySelector('[data-target="triagem"]').click();
        });

        // Atualizar select quando paciente é selecionado (controle de presença)
        document.getElementById('patientSelectAttendance').addEventListener('change', function() {
            const patientId = this.value;
            
            if(!patientId) {
                document.getElementById('patientAttendanceInfo').classList.add('hidden');
                return;
            }
            
            const transaction = db.transaction([STORE_NAME], "readonly");
            const store = transaction.objectStore(STORE_NAME);
            const request = store.get(Number(patientId));
            
            request.onsuccess = () => {
                const patient = request.result;
                
                if(patient) {
                    document.getElementById('patientAttendanceName').textContent = patient.nome;
                    document.getElementById('attendanceCount').textContent = patient.presencas ? patient.presencas.length : 0;
                    
                    const aptoBadge = document.getElementById('aptoBadge');
                    if(patient.apto) {
                        aptoBadge.innerHTML = '<i class="fa-solid fa-check mr-1"></i> Apto';
                        aptoBadge.className = 'bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm';
                        document.getElementById('aptoStatus').textContent = 'Apto para consulta médica';
                    } else {
                        aptoBadge.innerHTML = '<i class="fa-solid fa-xmark mr-1"></i> Não Apto';
                        aptoBadge.className = 'bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm';
                        document.getElementById('aptoStatus').textContent = 'Ainda não está apto para consulta médica';
                    }
                    
                    document.getElementById('patientAttendanceInfo').classList.remove('hidden');
                    
                    // Preencher lista de presenças
                    const attendanceList = document.getElementById('attendanceList');
                    attendanceList.innerHTML = '';
                    
                    if(!patient.presencas || patient.presencas.length === 0) {
                        attendanceList.innerHTML = `
                            <div class="text-center py-10 text-gray-400">
                                <i class="fa-regular fa-calendar text-3xl mb-3"></i>
                                <p>Nenhuma presença registrada</p>
                            </div>
                        `;
                    } else {
                        patient.presencas.forEach(presenca => {
                            const div = document.createElement('div');
                            div.className = 'flex justify-between items-center py-3 border-b';
                            div.innerHTML = `
                                <div>
                                    <p class="font-medium">${formatDate(presenca.date)}</p>
                                    <p class="text-sm text-gray-500">
                                        ${getSessionTypeText(presenca.type)} - ${getLocationText(presenca.location)}
                                    </p>
                                </div>
                                <button class="text-red-500 delete-attendance" data-date="${presenca.date}">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            `;
                            attendanceList.appendChild(div);
                        });
                    }
                    
                    // Definir data padrão para hoje
                    document.getElementById('attendanceDate').value = new Date().toISOString().split('T')[0];
                }
            };
        });

        // Formatar data
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        function getSessionTypeText(type) {
            const types = {
                'grupo': 'Grupo de Apoio',
                'individual': 'Acompanhamento Individual',
                'medica': 'Consulta Médica'
            };
            return types[type] || type;
        }

        function getLocationText(location) {
            const locations = {
                'central': 'Centro de Saúde Central',
                'jardins': 'UBS Jardins',
                'comunitario': 'Centro Comunitário'
            };
            return locations[location] || location;
        }

        // Registrar presença
        document.getElementById('attendanceForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const patientId = document.getElementById('patientSelectAttendance').value;
            if(!patientId) {
                alert('Selecione um paciente primeiro');
                return;
            }
            
            const transaction = db.transaction([STORE_NAME], "readwrite");
            const store = transaction.objectStore(STORE_NAME);
            const getRequest = store.get(Number(patientId));
            
            getRequest.onsuccess = () => {
                const patient = getRequest.result;
                
                if(!patient.presencas) {
                    patient.presencas = [];
                }
                
                const attendanceDate = document.getElementById('attendanceDate').value;
                const existingAttendance = patient.presencas.find(p => p.date === attendanceDate);
                
                if(existingAttendance) {
                    alert('Presença para esta data já registrada');
                    return;
                }
                
                const newAttendance = {
                    date: attendanceDate,
                    type: document.getElementById('sessionType').value,
                    location: document.getElementById('sessionLocation').value
                };
                
                patient.presencas.push(newAttendance);
                
                // Atualizar status "apto"
                if(patient.presencas.length >= 3 && !patient.apto) {
                    patient.apto = true;
                }
                
                const updateRequest = store.put(patient);
                updateRequest.onsuccess = () => {
                    console.log('Presença registrada');
                    
                    // Atualizar UI de presenças
                    const attendanceList = document.getElementById('attendanceList');
                    const div = document.createElement('div');
                    div.className = 'flex justify-between items-center py-3 border-b';
                    div.innerHTML = `
                        <div>
                            <p class="font-medium">${formatDate(newAttendance.date)}</p>
                            <p class="text-sm text-gray-500">
                                ${getSessionTypeText(newAttendance.type)} - ${getLocationText(newAttendance.location)}
                            </p>
                        </div>
                        <button class="text-red-500 delete-attendance" data-date="${newAttendance.date}">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    `;
                    
                    // Adicionar no início e remover placeholder
                    if(attendanceList.querySelector('.text-center')) {
                        attendanceList.innerHTML = '';
                    }
                    attendanceList.insertBefore(div, attendanceList.firstChild);
                    
                    // Atualizar contador e status
                    document.getElementById('attendanceCount').textContent = patient.presencas.length;
                    const aptoBadge = document.getElementById('aptoBadge');
                    
                    if(patient.apto) {
                        aptoBadge.innerHTML = '<i class="fa-solid fa-check mr-1"></i> Apto';
                        aptoBadge.className = 'bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm';
                        document.getElementById('aptoStatus').textContent = 'Apto para consulta médica';
                    }
                    
                    // Feedback ao usuário
                    alert('Presença registrada com sucesso!');
                };
            };
        });

        // Calcular dependência à nicotina
        document.getElementById('btnCalculate').addEventListener('click', () => {
            const form = document.getElementById('assessmentForm');
            const tempo = form.querySelector('input[name="tempo"]:checked');
            const cigarros = form.querySelector('input[name="cigarros"]:checked');
            const dificuldade = form.querySelector('input[name="dificuldade"]:checked');
            
            if(!tempo || !cigarros || !dificuldade) {
                alert('Responda todas as perguntas');
                return;
            }
            
            let score = 0;
            score += parseInt(tempo.value);
            score += parseInt(cigarros.value);
            score += parseInt(dificuldade.value);
            
            let level, description;
            if(score <= 3) {
                level = "Baixa";
                description = "Você apresenta dependência física baixa à nicotina.";
            } else if(score <= 6) {
                level = "Moderada";
                description = "Você apresenta dependência física moderada à nicotina.";
            } else {
                level = "Alta";
                description = "Você apresenta dependência física alta à nicotina.";
            }
            
            // Mostrar resultado
            document.getElementById('dependenceLevel').textContent = level;
            document.getElementById('dependenceDescription').textContent = description;
            document.getElementById('resultPanel').classList.remove('hidden');
            
            // Mudar o botão para salvar
            document.querySelector('#btnCalculate').classList.add('hidden');
            document.querySelector('#assessmentForm [type="submit"]').classList.remove('hidden');
        });

        // Salvar avaliação de dependência
        document.getElementById('assessmentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const patientId = document.getElementById('patientSelectAssessment').value;
            if(!patientId) {
                alert('Selecione um paciente');
                return;
            }
            
            const form = this;
            const tempo = form.querySelector('input[name="tempo"]:checked');
            const cigarros = form.querySelector('input[name="cigarros"]:checked');
            const dificuldade = form.querySelector('input[name="dificuldade"]:checked');
            
            if(!tempo || !cigarros || !dificuldade) {
                alert('Responda todas as perguntas');
                return;
            }
            
            const resultPanel = document.getElementById('resultPanel');
            const level = document.getElementById('dependenceLevel').textContent;
            
            // Atualizar paciente
            const transaction = db.transaction([STORE_NAME], "readwrite");
            const store = transaction.objectStore(STORE_NAME);
            const getRequest = store.get(Number(patientId));
            
            getRequest.onsuccess = () => {
                const patient = getRequest.result;
                patient.dependencia = {
                    level: level,
                    date: new Date().toISOString(),
                    answers: {
                        tempo: tempo.value,
                        cigarros: cigarros.value,
                        dificuldade: dificuldade.value
                    }
                };
                
                const updateRequest = store.put(patient);
                updateRequest.onsuccess = () => {
                    console.log('Avaliação de dependência salva');
                    
                    // Feedback ao usuário
                    alert(`Dependência à nicotina salva: ${level}`);
                    
                    // Resetar formulário e mostrar botão calcular
                    form.reset();
                    resultPanel.classList.add('hidden');
                    document.querySelector('#btnCalculate').classList.remove('hidden');
                    document.querySelector('#assessmentForm [type="submit"]').classList.add('hidden');
                    
                    // Voltar para o dashboard
                    document.querySelector('[data-target="dashboard"]').click();
                };
            };
        });

        // Compartilhar por WhatsApp
        document.getElementById('btnShare').addEventListener('click', () => {
            // Criar um blob do banco de dados (simulado)
            // Em um sistema real, você exportaria os dados para JSON primeiro
            alert('Função de compartilhamento via WhatsApp disponível apenas em ambiente implementado');
        });

        // Imprimir relatório
        document.getElementById('btnPrint').addEventListener('click', () => {
            document.getElementById('printDate').textContent = new Date().toLocaleDateString('pt-BR');
            const printTable = document.getElementById('printTable');
            printTable.innerHTML = '';
            
            getAllPatients(patients => {
                patients.forEach(patient => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="border border-gray-300 px-4 py-2">${patient.nome}</td>
                        <td class="border border-gray-300 px-4 py-2">${patient.cpf || '-'}</td>
                        <td class="border border-gray-300 px-4 py-2">${patient.sus || '-'}</td>
                        <td class="border border-gray-300 px-4 py-2">
                            ${patient.triagem ? 'Completa' : 'Incompleta'}
                        </td>
                        <td class="border border-gray-300 px-4 py-2">
                            ${patient.dependencia ? patient.dependencia.level : '-'}
                        </td>
                        <td class="border border-gray-300 px-4 py-2">
                            ${patient.presencas ? patient.presencas.length : 0}
                        </td>
                    `;
                    printTable.appendChild(tr);
                });
                
                // Ativar área de impressão
                document.querySelector('.print-section').classList.remove('print-section');
                
                // Imprimir
                window.print();
                
                // Restaurar
                setTimeout(() => {
                    document.querySelector('div:not(.print-section)').classList.add('print-section');
                }, 100);
            });
        });

        // Limpar todos os dados
        document.getElementById('btnDeleteAll').addEventListener('click', deleteAllPatients);

        // Atualizar dados manualmente
        document.getElementById('btnRefreshPatients').addEventListener('click', loadPatients);

        // Aplicar máscaras
        function applyMasks() {
            $('#patientForm input[name="cpf"]').mask('000.000.000-00', {reverse: true});
            $('#patientForm input[name="sus"]').mask('000 0000 0000 0000');
            $('#patientForm input[name="telefone"]').mask('(00) 00000-0000');
        }

        // Implementação de máscara vanilla JS
        function vanillaMask(input, pattern) {
            input.addEventListener('input', function(e) {
                const value = this.value.replace(/\D/g, '');
                let result = '';
                let index = 0;
                
                for (let i = 0; i < pattern.length; i++) {
                    if (pattern[i] === '0') {
                        if (value[index]) {
                            result += value[index++];
                        } else {
                            break;
                        }
                    } else {
                        result += pattern[i];
                    }
                }
                
                this.value = result;
            });
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            // Aplicar máscaras vanilla JS
            document.querySelectorAll('[data-mask]').forEach(input => {
                const pattern = input.getAttribute('data-mask');
                const reverse = input.hasAttribute('data-mask-reverse');
                vanillaMask(input, pattern, reverse);
            });
            applyMasks();
            // Iniciar com o dashboard
            document.querySelector('[data-target="dashboard"]').classList.add('active');
            document.getElementById('dashboard').classList.add('active');
            document.getElementById('dashboard').classList.remove('hidden');
            
            // Definir data padrão para formulários de presença
            document.getElementById('attendanceDate').value = new Date().toISOString().split('T')[0];
        });
    </script>
</body>
</html>
